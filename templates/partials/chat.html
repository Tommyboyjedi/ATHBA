{% load static %}

<div class="chat-container">
  <div class="chat-header">
    <h2 class="font-semibold">Chat – {{ project.name }}</h2>
  </div>

  <div id="chat-stream" class="chat-stream" hx-ext="sse" sse-connect="/chat/stream/" sse-swap="chat" hx-swap="beforeend">
    {% for msg in chat_log %}
      <div class="message {% if msg.sender == 'human' %}message-human{% else %}message-system{% endif %}">
        <strong>{{ msg.sender }}:</strong> {{ msg.message }}
      </div>
    {% endfor %}
  </div>

<form id="chat-form"
      hx-post="/api/chat/send"
      hx-target="#chat-form"
      hx-swap="none"
      class="chat-form"
      onsubmit="
        const input = this.querySelector('input[name=message]');
        const val = input.value.trim();
        if (val) {
          document.querySelector('#chat-stream').insertAdjacentHTML(
            'beforeend',
            `<div class='message message-human'><strong>You:</strong> ${val}</div>`
          );
        }
      ">
  <input
      type="text"
      name="message"
      oninput="this.setCustomValidity('')"
      oninvalid="this.setCustomValidity('Type something!')"
      placeholder="Type a message…"
      class="chat-input"
      required
    />

  <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Send</button>
</form>


</div>
<script>
  if (window.htmx) {
    htmx.process(document.getElementById('chat-stream'));
  }
</script>